# Bale Mini App - Ø³Ø§Ù…Ø§Ù†Ù‡ Ø±ÙØ§Ù‡ÛŒ Ø¨Ø§Ù†Ú© Ù…Ù„ÛŒ

Ø§ÛŒÙ† Ù…ÛŒÙ†ÛŒâ€ŒØ§Ù¾ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù¾Ø±Ø³Ù†Ù„ Ø¨Ø§Ù†Ú© Ù…Ù„ÛŒ Ø¬Ù‡Øª Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø±ÙÛŒâ€ŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø§Ú©Ø² Ø±ÙØ§Ù‡ÛŒ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø§Ø³Øª.

## ğŸ“± ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§

- âœ… ÙˆØ±ÙˆØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§ Bale (Ø¨Ø¯ÙˆÙ† username/password)
- âœ… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø§ÙˆÙ„ÛŒÙ‡ Ù¾Ø±Ø³Ù†Ù„
- âœ… Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ù‡Ù…Ø§Ù†Ø§Ù† (Ø§ÙØ±Ø§Ø¯ ØºÛŒØ±Ù¾Ø±Ø³Ù†Ù„)
- âœ… Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ù…Ø±Ø§Ù‡Ø§Ù† Ù¾Ø±Ø³Ù†Ù„ (Ø§ÙØ±Ø§Ø¯ Ù¾Ø±Ø³Ù†Ù„)
- âœ… ØµØ¯ÙˆØ± Ù…Ø¹Ø±ÙÛŒâ€ŒÙ†Ø§Ù…Ù‡ Ø¨Ø§ wizard 3 Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ
- âœ… Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø³Ù‡Ù…ÛŒÙ‡ Ø¨Ù‡ ØªÙÚ©ÛŒÚ© Ù…Ø±Ú©Ø²
- âœ… Ù„ÛŒØ³Øª Ùˆ Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø¹Ø±ÙÛŒâ€ŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§
- âœ… Ø·Ø±Ø§Ø­ÛŒ Mobile-First Ùˆ ØªÙ…Ø§Ù…â€ŒØµÙØ­Ù‡
- âœ… Navigation Ø¨Ø§ Bottom Tab Bar
- âœ… PWA Support (Ù†ØµØ¨ Ø±ÙˆÛŒ Ú¯ÙˆØ´ÛŒ)

---

## ğŸš€ Ù†ØµØ¨ Ùˆ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ

### 1. Ù†ØµØ¨ Dependencies

```bash
cd resources/mini-app
npm install
```

### 2. Development

```bash
npm run dev
```

Ø³Ù¾Ø³ Ù…Ø±ÙˆØ±Ú¯Ø± Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯: `http://localhost:5173`

### 3. Build Ø¨Ø±Ø§ÛŒ Production

```bash
npm run build
```

ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ build Ø´Ø¯Ù‡ Ø¯Ø± `public/mini-app/` Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù†Ø¯.

---

## ğŸ”§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Bale Bot

### Ù…Ø±Ø­Ù„Ù‡ 1: Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† BotFather

1. Ø¯Ø± Ø¨Ù„Ù‡ØŒ Ø¨Ù‡ `@BotFather` Ù¾ÛŒØ§Ù… Ø¯Ù‡ÛŒØ¯
2. Ø¯Ø³ØªÙˆØ± `/mybots` Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯
3. Ø±Ø¨Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯

### Ù…Ø±Ø­Ù„Ù‡ 2: ØªÙ†Ø¸ÛŒÙ… Mini App Button

```
/setmenubutton
â†’ Ø§Ù†ØªØ®Ø§Ø¨ Bot
â†’ Mini App URL: https://ria.jafamhis.ir/welfare/mini-app/
â†’ Button Text: Ø³Ø§Ù…Ø§Ù†Ù‡ Ø±ÙØ§Ù‡ÛŒ
```

### Ù…Ø±Ø­Ù„Ù‡ 3: ØªØ³Øª

1. Ø±Ø¨Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ø¨Ù„Ù‡ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯
2. Ø¯Ú©Ù…Ù‡ "Ø³Ø§Ù…Ø§Ù†Ù‡ Ø±ÙØ§Ù‡ÛŒ" (Menu Button) Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯
3. Ù…ÛŒÙ†ÛŒâ€ŒØ§Ù¾ Ø¨Ø§Ø² Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ ÙˆØ±ÙˆØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯

---

## ğŸ“‚ Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø±ÙˆÚ˜Ù‡

```
resources/mini-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ assets/           # ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªØ§ØªÛŒÚ© (CSS, fonts)
â”‚   â”œâ”€â”€ components/       # Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øªâ€ŒÙ‡Ø§ÛŒ Vue
â”‚   â”‚   â”œâ”€â”€ common/       # Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ØŒ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ØŒ ...
â”‚   â”‚   â””â”€â”€ layout/       # BottomNav, Header, ...
â”‚   â”œâ”€â”€ composables/      # Vue composables (Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…Ø¬Ø¯Ø¯)
â”‚   â”œâ”€â”€ router/           # Vue Router ØªÙ†Ø¸ÛŒÙ…Ø§Øª
â”‚   â”œâ”€â”€ stores/           # Pinia State Management
â”‚   â”‚   â”œâ”€â”€ auth.js       # Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
â”‚   â”‚   â”œâ”€â”€ personnel.js  # Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±Ø³Ù†Ù„
â”‚   â”‚   â”œâ”€â”€ guests.js     # Ù…Ù‡Ù…Ø§Ù†Ø§Ù†
â”‚   â”‚   â””â”€â”€ letters.js    # Ù…Ø¹Ø±ÙÛŒâ€ŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§
â”‚   â”œâ”€â”€ utils/            # ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ
â”‚   â”‚   â””â”€â”€ axios.js      # HTTP Client Ø¨Ø§ interceptors
â”‚   â”œâ”€â”€ views/            # ØµÙØ­Ø§Øª Ø§ØµÙ„ÛŒ
â”‚   â”‚   â”œâ”€â”€ LoginView.vue
â”‚   â”‚   â”œâ”€â”€ RegisterView.vue
â”‚   â”‚   â”œâ”€â”€ PendingView.vue
â”‚   â”‚   â”œâ”€â”€ HomeView.vue
â”‚   â”‚   â”œâ”€â”€ GuestsView.vue
â”‚   â”‚   â”œâ”€â”€ LettersView.vue
â”‚   â”‚   â”œâ”€â”€ NewLetterView.vue
â”‚   â”‚   â”œâ”€â”€ LetterDetailView.vue
â”‚   â”‚   â””â”€â”€ QuotasView.vue
â”‚   â”œâ”€â”€ App.vue           # Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø§ØµÙ„ÛŒ
â”‚   â””â”€â”€ main.js           # Entry point
â”œâ”€â”€ index.html
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.js
â”œâ”€â”€ tailwind.config.js
â””â”€â”€ README.md
```

---

## ğŸ¨ Ø·Ø±Ø§Ø­ÛŒ UI/UX

### Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ

- **Primary**: `#00A6A6` (Ø±Ù†Ú¯ Ø§ØµÙ„ÛŒ Ø¨Ù„Ù‡)
- **Secondary**: `#FF6B6B` (Ø±Ù†Ú¯ ØªØ£Ú©ÛŒØ¯ÛŒ)
- **Success**: `#51CF66`
- **Warning**: `#FFD93D`
- **Danger**: `#FF6B6B`

### ÙÙˆÙ†Øª

- **Vazirmatn** (Ù…ØªÙ†â€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ)
- Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø³Ø§ÛŒØ²: `14px` (Ù…Ù†Ø§Ø³Ø¨ Ù…ÙˆØ¨Ø§ÛŒÙ„)

### Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§

- **Ø­Ø¯Ø§Ù‚Ù„ Ø§Ù†Ø¯Ø§Ø²Ù‡**: `44x44px` (touch-friendly)
- **Border Radius**: `8-12px` (Ú¯Ø±Ø¯ Ùˆ Ù†Ø±Ù…)
- **Active State**: `scale(0.95)` (ÙÛŒØ¯Ø¨Ú© Ù„Ù…Ø³ÛŒ)

---

## ğŸ” Authentication Flow

```
1. Ú©Ø§Ø±Ø¨Ø± Ù…ÛŒÙ†ÛŒâ€ŒØ§Ù¾ Ø±Ø§ Ø§Ø² Ø¨Ù„Ù‡ Ø¨Ø§Ø² Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   â†“
2. Bale SDK Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯: initData
   â†“
3. Frontend Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ø¨Ù‡: POST /api/mini-app/auth/verify
   â†“
4. Backend ØªØ£ÛŒÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯: Bale initData hash
   â†“
5. Backend Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯: Sanctum Token
   â†“
6. Frontend Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯: Token Ø¯Ø± localStorage
   â†“
7. Routing Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª:
   - Ø¨Ø¯ÙˆÙ† Ù¾Ø±Ø³Ù†Ù„ â†’ /register
   - Ù¾Ø±Ø³Ù†Ù„ pending â†’ /pending
   - Ù¾Ø±Ø³Ù†Ù„ approved â†’ /home (Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯)
```

---

## ğŸ“¡ API Endpoints

### Authentication
- `POST /api/mini-app/auth/verify` - ÙˆØ±ÙˆØ¯ Ø¨Ø§ Bale initData
- `GET /api/mini-app/auth/me` - Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ù„ÛŒ

### Personnel
- `GET /api/mini-app/personnel/me` - Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±Ø³Ù†Ù„ + Ø³Ù‡Ù…ÛŒÙ‡
- `POST /api/mini-app/personnel/register` - Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù¾Ø±Ø³Ù†Ù„ Ø¬Ø¯ÛŒØ¯
- `PATCH /api/mini-app/personnel/update` - Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ

### Guests (Ù…Ù‡Ù…Ø§Ù†Ø§Ù†)
- `GET /api/mini-app/guests` - Ù„ÛŒØ³Øª Ù…Ù‡Ù…Ø§Ù†Ø§Ù†
- `POST /api/mini-app/guests` - Ø§ÙØ²ÙˆØ¯Ù† Ù…Ù‡Ù…Ø§Ù†
- `PATCH /api/mini-app/guests/{id}` - ÙˆÛŒØ±Ø§ÛŒØ´
- `DELETE /api/mini-app/guests/{id}` - Ø­Ø°Ù

### Personnel Guests (Ù‡Ù…Ø±Ø§Ù‡Ø§Ù† Ù¾Ø±Ø³Ù†Ù„)
- `GET /api/mini-app/personnel-guests` - Ù„ÛŒØ³Øª Ù‡Ù…Ø±Ø§Ù‡Ø§Ù†
- `GET /api/mini-app/personnel-guests/search?employee_code=...` - Ø¬Ø³ØªØ¬Ùˆ
- `POST /api/mini-app/personnel-guests` - Ø§ÙØ²ÙˆØ¯Ù†
- `DELETE /api/mini-app/personnel-guests/{id}` - Ø­Ø°Ù

### Letters (Ù…Ø¹Ø±ÙÛŒâ€ŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§)
- `GET /api/mini-app/letters` - Ù„ÛŒØ³Øª Ù…Ø¹Ø±ÙÛŒâ€ŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§
- `POST /api/mini-app/letters` - ØµØ¯ÙˆØ± Ù…Ø¹Ø±ÙÛŒâ€ŒÙ†Ø§Ù…Ù‡ Ø¬Ø¯ÛŒØ¯
- `GET /api/mini-app/letters/{id}` - Ø¬Ø²Ø¦ÛŒØ§Øª
- `DELETE /api/mini-app/letters/{id}/cancel` - Ù„ØºÙˆ

### Centers & Quotas
- `GET /api/mini-app/centers` - Ù„ÛŒØ³Øª Ù…Ø±Ø§Ú©Ø² ÙØ¹Ø§Ù„
- `GET /api/mini-app/quotas` - Ø³Ù‡Ù…ÛŒÙ‡ Ú©Ø§Ø±Ø¨Ø± (Ø¨Ù‡ ØªÙÚ©ÛŒÚ© Ù…Ø±Ú©Ø²)

---

## ğŸŒ Environment Variables

Ø¯Ø± `.env` Ø§ØµÙ„ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡:

```env
# Bale Bot Token (Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ initData)
BALE_BOT_TOKEN=your_bot_token_here

# App URL (Ø¨Ø±Ø§ÛŒ CORS)
APP_URL=https://ria.jafamhis.ir
```

---

## âš¡ Performance

### Bundle Size Optimization

- **Code Splitting**: Lazy loading Ø¨Ø±Ø§ÛŒ routes
- **Tree Shaking**: ÙÙ‚Ø· Ú©Ø¯Ù‡Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡
- **Asset Optimization**: ÙÙˆÙ†Øªâ€ŒÙ‡Ø§ Ùˆ ØªØµØ§ÙˆÛŒØ± Ø¨Ù‡ÛŒÙ†Ù‡

### PWA Features

- **Service Worker**: Ú©Ø´ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªØ§ØªÛŒÚ©
- **Offline Support**: Ú©Ø§Ø± Ø¨Ø¯ÙˆÙ† Ø§ÛŒÙ†ØªØ±Ù†Øª (Ù…Ø­Ø¯ÙˆØ¯)
- **Install Prompt**: Ù†ØµØ¨ Ø±ÙˆÛŒ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ú¯ÙˆØ´ÛŒ

---

## ğŸ› Debugging

### Ú†Ú© Ú©Ø±Ø¯Ù† Bale initData

```javascript
console.log(window.Bale?.WebApp?.initData)
```

### Ú†Ú© Ú©Ø±Ø¯Ù† Token

```javascript
console.log(localStorage.getItem('auth_token'))
```

### Ú†Ú© Ú©Ø±Ø¯Ù† User Data

```javascript
console.log(JSON.parse(localStorage.getItem('user')))
```

---

## ğŸ“± ØªØ³Øª Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„

### Ø±ÙˆØ´ 1: Bale Bot (ØªÙˆØµÛŒÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯)

1. Ø±Ø¨Ø§Øª Ø±Ø§ Ø¯Ø± Ø¨Ù„Ù‡ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯
2. Ø¯Ú©Ù…Ù‡ Menu Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯
3. Ù…ÛŒÙ†ÛŒâ€ŒØ§Ù¾ Ø¨Ø§Ø² Ù…ÛŒâ€ŒØ´ÙˆØ¯

### Ø±ÙˆØ´ 2: Ù…Ø±ÙˆØ±Ú¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„

1. Ø¯Ø± Chrome Mobile Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯: `https://ria.jafamhis.ir/welfare/mini-app/`
2. Ø¯Ú©Ù…Ù‡ Menu â†’ "Add to Home Screen"
3. Ø§Ø² home screen Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†)

---

## ğŸ”’ Security Checklist

- âœ… initData Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± backend ØªØ£ÛŒÛŒØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯
- âœ… Bot Token Ù‡Ø±Ú¯Ø² Ø¯Ø± frontend Ù‚Ø±Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯
- âœ… Sanctum Token ÙÙ‚Ø· Ø¯Ø± HTTPS Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
- âœ… CORS ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ domain Ù…Ø´Ø®Øµ
- âœ… Input validation Ø¯Ø± backend Ùˆ frontend
- âœ… XSS Protection Ø¨Ø§ Vue (auto-escaping)

---

## ğŸ“ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±ÙˆØ² Ù…Ø´Ú©Ù„:

1. Console Ù…Ø±ÙˆØ±Ú¯Ø± Ø±Ø§ Ú†Ú© Ú©Ù†ÛŒØ¯ (F12)
2. Network Tab Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯
3. Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Laravel Ø±Ø§ Ø¨Ø®ÙˆØ§Ù†ÛŒØ¯: `storage/logs/laravel.log`

---

**Ù†Ø³Ø®Ù‡**: 1.0.0
**ØªØ§Ø±ÛŒØ®**: 2024-02-14
**ÙˆØ¶Ø¹ÛŒØª**: âœ… Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡
