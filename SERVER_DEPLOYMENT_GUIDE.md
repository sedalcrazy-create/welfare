# ğŸš€ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Deploy Ø±ÙˆÛŒ Ø³Ø±ÙˆØ±

## ğŸ‰ ÙˆØ¶Ø¹ÛŒØª Ù†Ù‡Ø§ÛŒÛŒ: Ù‡Ù…Ù‡ Ú†ÛŒØ² Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª!

**âœ… Deploy Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯ - ØªØ§Ø±ÛŒØ®: 1405/11/26 (2026-02-14)**

---

## âœ… Ø®Ù„Ø§ØµÙ‡: ØªÙ…Ø§Ù… Ù…Ø±Ø§Ø­Ù„ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡

### 1ï¸âƒ£ Git & Code
- âœ… ØªØºÛŒÛŒØ±Ø§Øª Ø§Ø² GitHub Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯ (17 ÙØ§ÛŒÙ„ØŒ 1,917 Ø®Ø·)
- âœ… Ø³ÛŒØ³ØªÙ… Ù…Ù‡Ù…Ø§Ù†Ø§Ù† Ú©Ø§Ù…Ù„ Ø´Ø¯ (migrations, models, controllers, views)

### 2ï¸âƒ£ Docker
- âœ… Redis Extension Ù†ØµØ¨ Ø´Ø¯ (Ø§Ø² GitHub)
- âœ… Ù‡Ù…Ù‡ 6 Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø¨Ø§Ù„Ø§ Ùˆ Ø³Ø§Ù„Ù… Ù‡Ø³ØªÙ†Ø¯
- âœ… Port conflicts Ø­Ù„ Ø´Ø¯ (8083, 5434, 6381)

### 3ï¸âƒ£ Database & Cache
- âœ… PostgreSQL Ù…ØªØµÙ„ (16.11, 25 Ø¬Ø¯ÙˆÙ„ØŒ 1.34 MB)
- âœ… Redis Ù…ØªØµÙ„ Ùˆ Ø³Ø§Ù„Ù…
- âœ… Migrations Ø§Ø¬Ø±Ø§ Ø´Ø¯ (2 migration Ø¬Ø¯ÛŒØ¯)

### 4ï¸âƒ£ Permissions & Config
- âœ… Storage permissions ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯ (www-data:www-data)
- âœ… Config cache Ù¾Ø§Ú© Ø´Ø¯
- âœ… .env ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯ (DB_HOST=postgres, REDIS_HOST=redis)

---

## ğŸŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø³Ø§Ù…Ø§Ù†Ù‡

### URLâ€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ:
- **HTTPS:** https://ria.jafamhis.ir/welfare/login
- **HTTP:** http://37.152.174.87:8083/welfare/login

### Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ±ÙˆØ¯ Ù¾ÛŒØ´â€ŒÙØ±Ø¶:
```
Ø§ÛŒÙ…ÛŒÙ„: admin@bankmelli.ir
Ø±Ù…Ø²: password
```

### Ù†Ø­ÙˆÙ‡ ØªØ³Øª Ø³ÛŒØ³ØªÙ… Ù…Ù‡Ù…Ø§Ù†Ø§Ù†:
1. ÙˆØ§Ø±Ø¯ Ø³ÛŒØ³ØªÙ… Ø´ÙˆÛŒØ¯
2. Ø¨Ù‡ Ø¨Ø®Ø´ **Ù¾Ø±Ø³Ù†Ù„** Ø¨Ø±ÙˆÛŒØ¯
3. ÛŒÚ© Ù¾Ø±Ø³Ù†Ù„ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯
4. Ø±ÙˆÛŒ ØªØ¨ **"Ù…Ù‡Ù…Ø§Ù†Ø§Ù†"** Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯
5. Ù…Ù‡Ù…Ø§Ù† Ø¬Ø¯ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯

---

## ğŸ“Š ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ø³Ø±ÙˆØ±

### Ú©Ø§Ù†ØªÛŒÙ†Ø±Ù‡Ø§ÛŒ ÙØ¹Ø§Ù„ (6 Ø¹Ø¯Ø¯):
```
âœ… welfare_app         - PHP-FPM
âœ… welfare_nginx       - Web Server (port 8083)
âœ… welfare_postgres    - Database (port 5434)
âœ… welfare_redis       - Cache/Queue (port 6381)
âœ… welfare_queue       - Queue Worker
âœ… welfare_scheduler   - Task Scheduler
```

### Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ:
- **Web:** 8083 â†’ 80 (nginx)
- **PostgreSQL:** 5434 â†’ 5432
- **Redis:** 6381 â†’ 6379

---

## ğŸ”§ Ù…Ø´Ú©Ù„Ø§Øª Ø­Ù„ Ø´Ø¯Ù‡

### Ø®Ø·Ø§ 1: Redis PECL Ù†ØµØ¨ Ù†Ø´Ø¯
**Ø±Ø§Ù‡ Ø­Ù„:** Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ compile Ø§Ø² GitHub
```dockerfile
RUN cd /tmp \
    && curl -L https://github.com/phpredis/phpredis/archive/6.0.2.tar.gz | tar xz \
    && cd phpredis-6.0.2 \
    && phpize && ./configure && make && make install \
    && docker-php-ext-enable redis
```

### Ø®Ø·Ø§ 2: Port Conflicts
**Ø±Ø§Ù‡ Ø­Ù„:** ØªØºÛŒÛŒØ± Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§ Ø¨Ø¯ÙˆÙ† ØªØ£Ø«ÛŒØ± Ø±ÙˆÛŒ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø±
- PostgreSQL: 5433 â†’ 5434
- Nginx: 8080 â†’ 8083

### Ø®Ø·Ø§ 3: Parse Error Ø¯Ø± bootstrap/app.php
**Ø±Ø§Ù‡ Ø­Ù„:** Ø­Ø°Ù Ø¨Ø®Ø´ withEvents (Laravel 11 Ù†ÛŒØ§Ø²ÛŒ Ù†Ø¯Ø§Ø±Ø¯)

### Ø®Ø·Ø§ 4: Database/Redis Connection
**Ø±Ø§Ù‡ Ø­Ù„:** ØªÙ†Ø¸ÛŒÙ… .env Ø¨Ø§ Ù†Ø§Ù…â€ŒÙ‡Ø§ÛŒ Docker service
- DB_HOST=postgres (Ù†Ù‡ IP)
- REDIS_HOST=redis (Ù†Ù‡ IP)

### Ø®Ø·Ø§ 5: Permission Denied (500 Error)
**Ø±Ø§Ù‡ Ø­Ù„:** ØªÙ†Ø¸ÛŒÙ… Ù…Ø§Ù„Ú©ÛŒØª storage
```bash
chown -R www-data:www-data /var/www/storage /var/www/bootstrap/cache
chmod -R 775 /var/www/storage /var/www/bootstrap/cache
```

---

## ğŸ› ï¸ Ø¯Ø³ØªÙˆØ±Ø§Øª Ù…ÙÛŒØ¯

### Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª:
```bash
ssh root@37.152.174.87
cd /var/www/welfare

# ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ù†ØªÛŒÙ†Ø±Ù‡Ø§
docker compose ps

# Ù„Ø§Ú¯â€ŒÙ‡Ø§
docker logs welfare_app
docker logs welfare_nginx

# ØªØ³Øª Ø§ØªØµØ§Ù„Ø§Øª
docker exec welfare_app php artisan db:show
docker exec welfare_app php artisan tinker --execute="use Illuminate\Support\Facades\Redis; echo Redis::connection()->ping();"
```

### Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† cache:
```bash
docker exec welfare_app php artisan config:clear
docker exec welfare_app php artisan cache:clear
docker exec welfare_app php artisan view:clear
docker exec welfare_app php artisan route:clear
```

### Migrations:
```bash
# Ø§Ø¬Ø±Ø§ÛŒ migrations
docker exec welfare_app php artisan migrate --force

# ÙˆØ¶Ø¹ÛŒØª migrations
docker exec welfare_app php artisan migrate:status
```

### Restart:
```bash
# Restart ØªÚ©â€ŒØªÚ© containers
docker compose restart app nginx

# Restart Ù‡Ù…Ù‡
docker compose restart

# Rebuild (Ø§Ú¯Ø± Dockerfile ØªØºÛŒÛŒØ± Ú©Ø±Ø¯)
docker compose down
docker compose up -d --build
```

---

## ğŸ“ ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ù‡Ù…

1. **Ø¨Ù‚ÛŒÙ‡ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§:** ØªÙ…Ø§Ù… 25 Ú©Ø§Ù†ØªÛŒÙ†Ø± Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± Ø³Ø§Ù„Ù… Ùˆ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ù‡Ø³ØªÙ†Ø¯
2. **Nginx Ø§ØµÙ„ÛŒ:** Ø³Ø±ÙˆØ± nginx Ø§ØµÙ„ÛŒ (/etc/nginx) Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø§Ø³Øª
3. **Reverse Proxy:** ØªÙ†Ø¸ÛŒÙ…Ø§Øª `/etc/nginx/sites-enabled/ria.jafamhis.ir` Ø¨Ø±Ø±Ø³ÛŒ Ùˆ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯
4. **Production Mode:** APP_DEBUG=false Ø¨Ø±Ø§ÛŒ Ø§Ù…Ù†ÛŒØª

---

**âœ… ÙˆØ¶Ø¹ÛŒØª: Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Production!**

ğŸ’¡ Ø¨Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ù…Ø´Ú©Ù„ ÛŒØ§ Ø³Ø¤Ø§Ù„: Ø¨Ø±Ø±Ø³ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø¯Ø± `storage/logs/laravel.log`
