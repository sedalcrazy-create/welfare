================================================================================
          گزارش کامل پیشرفت پروژه سامانه رفاهی بانک ملی ایران
                         تاریخ: 1404/10/28
================================================================================

بخش اول: خلاصه پروژه
--------------------------------------------------------------------------------
نام پروژه: سامانه جامع مدیریت مراکز رفاهی بانک ملی ایران
فناوری: Laravel 11 + PostgreSQL + Docker
سرور: 37.152.174.87 (Ubuntu 22.04.5)
پورت: 8083
مسیر: /var/www/welfare

================================================================================
بخش دوم: کارهای انجام شده
================================================================================

┌─────────────────────────────────────────────────────────────────────────────┐
│ 1. CRUD مراکز رفاهی (Centers) - تکمیل شده ✓                                │
└─────────────────────────────────────────────────────────────────────────────┘

فایل‌های ایجاد شده:
  • app/Http/Controllers/CenterController.php
  • resources/views/centers/index.blade.php
  • resources/views/centers/create.blade.php
  • resources/views/centers/edit.blade.php
  • resources/views/centers/show.blade.php

قابلیت‌ها:
  • نمایش لیست مراکز با فیلتر و جستجو
  • افزودن مرکز جدید
  • ویرایش اطلاعات مرکز
  • مشاهده جزئیات مرکز با آمار واحدها
  • تغییر وضعیت فعال/غیرفعال
  • نمایش امکانات به صورت JSON

Routes:
  GET    /centers              - لیست مراکز
  GET    /centers/create       - فرم افزودن
  POST   /centers              - ذخیره مرکز
  GET    /centers/{id}         - مشاهده جزئیات
  GET    /centers/{id}/edit    - فرم ویرایش
  PUT    /centers/{id}         - بروزرسانی
  DELETE /centers/{id}         - حذف
  PATCH  /centers/{id}/toggle  - تغییر وضعیت

داده‌های موجود: 3 مرکز
  1. زائرسرای مشهد - 227 واحد - 5 شب اقامت
  2. متل بابلسر - 165 واحد - 4 شب اقامت
  3. موتل چادگان - 34 واحد - 3 شب اقامت

┌─────────────────────────────────────────────────────────────────────────────┐
│ 2. CRUD واحدها (Units) - تکمیل شده ✓                                       │
└─────────────────────────────────────────────────────────────────────────────┘

فایل‌های ایجاد شده:
  • app/Http/Controllers/UnitController.php
  • resources/views/units/index.blade.php
  • resources/views/units/create.blade.php
  • resources/views/units/edit.blade.php
  • resources/views/units/show.blade.php

قابلیت‌ها:
  • نمایش لیست واحدها با فیلتر مرکز، نوع، وضعیت
  • افزودن واحد جدید
  • ویرایش اطلاعات واحد
  • مشاهده جزئیات واحد
  • تغییر وضعیت فعال/غیرفعال
  • بروزرسانی خودکار شمارنده مرکز

Routes:
  GET    /units                - لیست واحدها
  GET    /units/create         - فرم افزودن
  POST   /units                - ذخیره واحد
  GET    /units/{id}           - مشاهده جزئیات
  GET    /units/{id}/edit      - فرم ویرایش
  PUT    /units/{id}           - بروزرسانی
  DELETE /units/{id}           - حذف
  PATCH  /units/{id}/toggle    - تغییر وضعیت

داده‌های موجود: 426 واحد
  • مشهد: 227 واحد (1029 تخت)
  • بابلسر: 165 واحد (626 تخت)
  • چادگان: 34 واحد (126 تخت)

انواع واحد: room (اتاق), suite (سوئیت), villa (ویلا)

┌─────────────────────────────────────────────────────────────────────────────┐
│ 3. CRUD دوره‌ها (Periods) - تکمیل شده ✓                                     │
└─────────────────────────────────────────────────────────────────────────────┘

فایل‌های ایجاد شده:
  • app/Http/Controllers/PeriodController.php
  • resources/views/periods/index.blade.php
  • resources/views/periods/create.blade.php
  • resources/views/periods/edit.blade.php
  • resources/views/periods/show.blade.php

قابلیت‌ها:
  • نمایش لیست دوره‌ها با فیلتر مرکز، وضعیت، تاریخ
  • افزودن دوره جدید با تاریخ شمسی
  • تبدیل خودکار تاریخ شمسی به میلادی
  • تولید کد یکتا (مثال: MSH-202601-01)
  • مدیریت وضعیت (draft/open/closed/completed)
  • ارتباط با فصل (Season)
  • نمایش آمار رزرو و ظرفیت

Routes:
  GET    /periods                      - لیست دوره‌ها
  GET    /periods/create               - فرم افزودن
  POST   /periods                      - ذخیره دوره
  GET    /periods/{id}                 - مشاهده جزئیات
  GET    /periods/{id}/edit            - فرم ویرایش
  PUT    /periods/{id}                 - بروزرسانی
  DELETE /periods/{id}                 - حذف
  PATCH  /periods/{id}/change-status   - تغییر وضعیت
  GET    /centers/{id}/seasons         - دریافت فصل‌ها (AJAX)

وضعیت‌های دوره:
  • draft (پیش‌نویس)
  • open (باز - آماده ثبت‌نام)
  • closed (بسته)
  • completed (تکمیل شده)

┌─────────────────────────────────────────────────────────────────────────────┐
│ 4. طراحی مجدد سایدبار - تکمیل شده ✓                                        │
└─────────────────────────────────────────────────────────────────────────────┘

فایل ویرایش شده:
  • resources/views/layouts/app.blade.php

تغییرات:
  • طراحی مدرن با تم navy blue/gold
  • دسته‌بندی منو به بخش‌های:
    - منوی اصلی (داشبورد)
    - مدیریت مراکز (مراکز، واحدها، دوره‌ها)
    - عملیات (قرعه‌کشی، رزروها)
    - اطلاعات پایه (پرسنل، استان‌ها)
    - گزارشات
  • نشانگر صفحه فعال
  • کارت کاربر با آواتار
  • طراحی ریسپانسیو

================================================================================
بخش سوم: کارهای باقی‌مانده
================================================================================

┌─────────────────────────────────────────────────────────────────────────────┐
│ 1. CRUD قرعه‌کشی (Lottery) - در انتظار                                      │
└─────────────────────────────────────────────────────────────────────────────┘

فایل‌های مورد نیاز:
  • app/Http/Controllers/LotteryController.php
  • resources/views/lotteries/index.blade.php
  • resources/views/lotteries/create.blade.php
  • resources/views/lotteries/edit.blade.php
  • resources/views/lotteries/show.blade.php

قابلیت‌های مورد نیاز:
  • ایجاد قرعه‌کشی برای هر دوره
  • مدیریت شرکت‌کنندگان (LotteryEntry)
  • اجرای الگوریتم قرعه‌کشی
  • محاسبه امتیاز اولویت
  • مدیریت لیست انتظار
  • ارتقا از لیست انتظار

الگوریتم امتیاز اولویت:
  score = 100 (پایه)
        + (روز از آخرین استفاده × 0.1)
        - (تعداد استفاده × 5)
        + (سنوات خدمت × 0.5)
        + امتیاز تطبیق خانواده (10)
        + تصادفی (0 تا 15)
        + امتیاز ایثارگری (30)
        + امتیاز عدم استفاده (50)

وضعیت‌های قرعه‌کشی:
  • draft (پیش‌نویس)
  • open (باز برای ثبت‌نام)
  • closed (بسته)
  • drawn (قرعه‌کشی شده)
  • completed (تکمیل)

┌─────────────────────────────────────────────────────────────────────────────┐
│ 2. CRUD رزروها (Reservations) - در انتظار                                  │
└─────────────────────────────────────────────────────────────────────────────┘

فایل‌های مورد نیاز:
  • app/Http/Controllers/ReservationController.php
  • resources/views/reservations/index.blade.php
  • resources/views/reservations/create.blade.php
  • resources/views/reservations/edit.blade.php
  • resources/views/reservations/show.blade.php

قابلیت‌های مورد نیاز:
  • ثبت رزرو پس از تایید قرعه‌کشی
  • تخصیص واحد به برنده
  • مدیریت مهمانان
  • محاسبه تعرفه
  • ثبت ورود/خروج
  • صدور فاکتور

انواع تعرفه:
  • نرخ بانک (2,000,000 ریال/شب برای کل خانواده)
  • نرخ آزاد بانکی (1,950,000 ریال/شب به ازای هر نفر)
  • نرخ آزاد غیربانکی (3,900,000 ریال/شب به ازای هر نفر)

┌─────────────────────────────────────────────────────────────────────────────┐
│ 3. CRUD پرسنل (Personnel) - در انتظار                                      │
└─────────────────────────────────────────────────────────────────────────────┘

فایل‌های مورد نیاز:
  • app/Http/Controllers/PersonnelController.php
  • resources/views/personnel/index.blade.php
  • resources/views/personnel/create.blade.php
  • resources/views/personnel/edit.blade.php
  • resources/views/personnel/show.blade.php

قابلیت‌های مورد نیاز:
  • مدیریت اطلاعات پرسنل
  • ثبت اعضای خانواده (JSON)
  • محاسبه سنوات خدمت
  • وضعیت ایثارگری
  • ورود اطلاعات از فایل اکسل/CSV
  • همگام‌سازی با سیستم بیمه

فیلدهای اصلی:
  • کد پرسنلی (employee_code)
  • کد ملی (national_code)
  • نام کامل
  • استان/اداره
  • سنوات خدمت
  • وضعیت ایثارگری
  • اطلاعات خانواده

┌─────────────────────────────────────────────────────────────────────────────┐
│ 4. CRUD استان‌ها (Provinces) - در انتظار                                    │
└─────────────────────────────────────────────────────────────────────────────┘

فایل‌های مورد نیاز:
  • app/Http/Controllers/ProvinceController.php
  • resources/views/provinces/index.blade.php
  • resources/views/provinces/create.blade.php
  • resources/views/provinces/edit.blade.php
  • resources/views/provinces/show.blade.php

قابلیت‌های مورد نیاز:
  • مدیریت 37 استان/اداره
  • تعریف سهمیه هر استان
  • محاسبه نسبت سهمیه
  • آمار پرسنل هر استان

داده‌ها:
  • 31 استان
  • 6 اداره امور تهران
  • مجموع پرسنل: حدود 70,000 نفر

┌─────────────────────────────────────────────────────────────────────────────┐
│ 5. گزارش‌ها (Reports) - در انتظار                                           │
└─────────────────────────────────────────────────────────────────────────────┘

گزارش‌های مورد نیاز:
  • گزارش اشغال مراکز (Occupancy Report)
  • گزارش استانی (Provincial Report)
  • گزارش مالی (Financial Report)
  • گزارش عدالت توزیع (Fairness Report)
  • گزارش سابقه استفاده

================================================================================
بخش چهارم: قوانین کسب‌وکار
================================================================================

1. قانون 3 سال:
   - هر پرسنل فقط در صورتی می‌تواند از نرخ بانک استفاده کند که
     حداقل 3 سال از آخرین استفاده او از همان مرکز گذشته باشد.
   - سهمیه هر مرکز جداگانه محاسبه می‌شود.

2. گردش کار تایید استانی:
   - پرسنل در قرعه‌کشی برنده می‌شود → وضعیت: won
   - مدیر استان تایید می‌کند → وضعیت: approved
   - واحد تخصیص داده می‌شود → رزرو ایجاد می‌شود
   - در صورت رد → نفر بعدی از همان استان ارتقا می‌یابد

3. تطبیق ظرفیت واحد:
   - اولویت: تطبیق دقیق → +1 تخت → -1 تخت (اگر تعداد > 2) → بزرگتر

4. توزیع سهمیه استانی:
   - 37 سهمیه: 31 استان + 6 اداره امور تهران
   - نسبت بر اساس تعداد پرسنل هر استان

================================================================================
بخش پنجم: معماری فنی
================================================================================

ساختار مدل‌ها:
  Province (استان)
  └── Personnel (پرسنل)

  Center (مرکز)
  ├── Unit (واحد)
  ├── Season (فصل)
  └── Period (دوره)
      └── Lottery (قرعه‌کشی)
          └── LotteryEntry (شرکت‌کننده)
              └── Reservation (رزرو)
                  └── UsageHistory (سابقه)

Docker Services:
  • welfare_app (PHP-FPM)
  • welfare_nginx (وب سرور - پورت 8080)
  • welfare_postgres (دیتابیس - پورت 5433)
  • welfare_redis (کش - پورت 6380)
  • welfare_queue (صف)
  • welfare_scheduler (زمان‌بندی)

================================================================================
بخش ششم: خلاصه وضعیت
================================================================================

ماژول‌های تکمیل شده:
  [✓] مراکز رفاهی (Centers)
  [✓] واحدها (Units)
  [✓] دوره‌ها (Periods)
  [✓] سایدبار و لایه‌آوت

ماژول‌های باقی‌مانده:
  [ ] قرعه‌کشی (Lottery)
  [ ] رزروها (Reservations)
  [ ] پرسنل (Personnel)
  [ ] استان‌ها (Provinces)
  [ ] گزارش‌ها (Reports)

درصد پیشرفت کلی: حدود 40%

================================================================================
                              پایان گزارش
================================================================================
