# ูุณุชูุฏุงุช ุณุณุชู ูพุฑุณููุ ูุธููโุจฺฏุฑุงู ู ูููุงูุงู

## ๐ฏ ุงูุฏุงู
ุณุงุฎุชุงุฑุฏู ุตุญุญ ุจู ุณู ุจุฎุด ุงุตู ุณุณุชู:
1. **ูพุฑุณูู** (ุดุงุบู ู ุจุงุฒูุดุณุชู)
2. **ูุธููโุจฺฏุฑุงู** (ุฎุงููุงุฏู ฺฉุงุฑููุฏุงู ููุช ุดุฏู)
3. **ูููุงูุงู** (ุงูุฑุงุฏ ููุฑุงู)

---

## ๐ ุณุงุฎุชุงุฑ ฺฉู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         1๏ธโฃ PERSONNEL (ูพุฑุณูู)               โ
โ  โข ููุน: active (ุดุงุบู) / retired (ุจุงุฒูุดุณุชู) โ
โ  โข ุดูุงุณู: employee_code (ฺฉุฏ ูพุฑุณูู)       โ
โ  โข ุณููู: โ ุฏุงุฑุฏ                          โ
โ  โข ูููุงูุงู: JSON (family_members)          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ      2๏ธโฃ BENEFICIARIES (ูุธููโุจฺฏุฑุงู)       โ
โ  โข ุฎุงููุงุฏู ฺฉุงุฑููุฏ ููุช ุดุฏู                 โ
โ  โข ุดูุงุณู: deceased_employee_code           โ
โ  โข ุงุนุถุง: ููุณุฑ + ุฏุฎุชุฑุงู ูุฌุฑุฏ                โ
โ  โข ููุงฺฉ: ููุฑ ุงูู (primary_beneficiary)     โ
โ  โข ูุงููู: ููุท ฺฉ ููุฑ ูโุชูุงูุฏ ุฏุฑุฎูุงุณุช ุฏูุฏ โ
โ  โข ุณููู: โ ุฏุงุฑุฏ                          โ
โ  โข ูููุงูุงู: JSON (guest_members)           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ           3๏ธโฃ GUESTS (ูููุงูุงู)              โ
โ  โข ุงูุฑุงุฏ ููุฑุงู ูพุฑุณูู ุง ูุธููโุจฺฏุฑ        โ
โ  โข ุฐุฎุฑู: JSON (ูู table ุฌุฏุงฺฏุงูู)         โ
โ  โข ุณููู: โ ูุฏุงุฑุฏ                         โ
โ  โข ููู ูุณุช ฺู ฺฉุณ ุจุงุดูุฏ                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฅ ุฏุณุชูโุจูุฏ ูููุงูุงู

### โ ุฎุงููุงุฏู ุจุงูฺฉ (Bank Affiliated)
ุชุญุช ูพูุดุด ุจูู ุจุงูฺฉ - ุชุนุฑูู ุงุฑุฒุงูโุชุฑ

| ูุณุจุช | Constant | ุชูุถุญ |
|------|----------|-------|
| ููุณุฑ | `RELATION_SPOUSE` | ููุณุฑ ฺฉุงุฑููุฏ/ูุธููโุจฺฏุฑ |
| ูุฑุฒูุฏ | `RELATION_CHILD` | ูุฑุฒูุฏ ฺฉุงุฑููุฏ/ูุธููโุจฺฏุฑ |
| ูพุฏุฑ | `RELATION_FATHER` | ูพุฏุฑ ฺฉุงุฑููุฏ/ูุธููโุจฺฏุฑ |
| ูุงุฏุฑ | `RELATION_MOTHER` | ูุงุฏุฑ ฺฉุงุฑููุฏ/ูุธููโุจฺฏุฑ |
| ูพุฏุฑ ููุณุฑ | `RELATION_FATHER_IN_LAW` | ูพุฏุฑ ููุณุฑ |
| ูุงุฏุฑ ููุณุฑ | `RELATION_MOTHER_IN_LAW` | ูุงุฏุฑ ููุณุฑ |

### โ๏ธ ูุชูุฑูู / ุบุฑ ุจุงูฺฉ (Miscellaneous)
ุฎุงุฑุฌ ุงุฒ ูพูุดุด ุจูู - ุชุนุฑูู ฺฏุฑุงูโุชุฑ

| ูุณุจุช | Constant | ุชูุถุญ |
|------|----------|-------|
| ุฏูุณุช | `RELATION_FRIEND` | ุฏูุณุช ฺฉุงุฑููุฏ |
| ูุงูู | `RELATION_RELATIVE` | ุฎูุดุงููุฏุงู ุฏฺฏุฑ |
| ุณุงุฑ | `RELATION_OTHER` | ุณุงุฑ ุงูุฑุงุฏ |

---

## ๐๏ธ ุณุงุฎุชุงุฑ Database

### Table 1: `personnel` (ููุฌูุฏ - ูุงุฒ ุจู ุชุบุฑ ุฌุฒุฆ)

```sql
-- ููุฏ ููุฌูุฏ ฺฉู ุจุงุฏ ุจุงู ุจูุงูุฏ
ALTER TABLE personnel
  MODIFY COLUMN employment_status ENUM('active', 'retired') NOT NULL DEFAULT 'active';

-- family_members ุจู ููู ุตูุฑุช JSON ุจุงู ูโูุงูุฏ
-- ุณุงุฎุชุงุฑ JSON:
-- [
--   {
--     "full_name": "ูุงู ฺฉุงูู",
--     "national_code": "1234567890",
--     "relation": "ููุณุฑ",
--     "birth_date": "1370/01/01",
--     "gender": "male/female"
--   }
-- ]
```

### Table 2: `beneficiaries` (ุฌุฏุฏ โ)

```sql
CREATE TABLE beneficiaries (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,

    -- ุงุทูุงุนุงุช ฺฉุงุฑููุฏ ููุช ุดุฏู
    deceased_employee_code VARCHAR(50) UNIQUE NOT NULL COMMENT 'ฺฉุฏ ูพุฑุณูู ููุช ุดุฏู',
    deceased_full_name VARCHAR(255) NOT NULL COMMENT 'ูุงู ฺฉุงุฑููุฏ ููุช ุดุฏู',
    deceased_national_code VARCHAR(10) NOT NULL COMMENT 'ฺฉุฏ ูู ููุช ุดุฏู',
    deceased_death_date DATE NULL COMMENT 'ุชุงุฑุฎ ููุช',

    -- ุงุนุถุง ุฎุงููุงุฏู (ููุณุฑ + ุฏุฎุชุฑุงู ูุฌุฑุฏ)
    family_members JSON NOT NULL COMMENT 'ูุณุช ุงุนุถุง (ููุณุฑ ู ุฏุฎุชุฑุงู ูุฌุฑุฏ)',
    -- ุณุงุฎุชุงุฑ:
    -- [
    --   {
    --     "full_name": "ูุงู",
    --     "national_code": "1234567890",
    --     "relation": "ููุณุฑ/ูุฑุฒูุฏ",
    --     "gender": "male/female",
    --     "birth_date": "1370/01/01",
    --     "marital_status": "single/married"  -- ููุท ุจุฑุง ุฏุฎุชุฑุงู
    --   }
    -- ]

    -- ููุงฺฉ (ููุฑ ุงูู ฺฉู ุญู ุฏุฑุฎูุงุณุช ุฏุงุฑุฏ)
    primary_beneficiary_national_code VARCHAR(10) NOT NULL COMMENT 'ฺฉุฏ ูู ููุงฺฉ (ููุฑ ุงูู)',
    primary_beneficiary_name VARCHAR(255) NOT NULL COMMENT 'ูุงู ููุงฺฉ',

    -- ูููุงูุงู (ุงูุฑุงุฏ ููุฑุงู)
    guest_members JSON NULL COMMENT 'ูุณุช ูููุงูุงู ููุฑุงู',
    -- ููุงู ุณุงุฎุชุงุฑ family_members

    -- ุฏุฑุฎูุงุณุช ูุนุงูุ
    has_active_request BOOLEAN DEFAULT FALSE COMMENT 'ุขุง ฺฉุณ ุฏุฑุฎูุงุณุช ูุนุงู ุฏุงุฑุฏุ',
    active_requester_national_code VARCHAR(10) NULL COMMENT 'ฺฉุฏ ูู ฺฉุณ ฺฉู ุฏุฑุฎูุงุณุช ุฏุงุฏู',
    last_request_date DATE NULL COMMENT 'ุชุงุฑุฎ ุขุฎุฑู ุฏุฑุฎูุงุณุช',

    -- ุงุทูุงุนุงุช ูฺฉุงู ู ูุถุนุช
    province_id BIGINT UNSIGNED NULL,
    phone VARCHAR(20) NULL,
    email VARCHAR(255) NULL,
    bale_user_id VARCHAR(50) NULL COMMENT 'ุดูุงุณู ฺฉุงุฑุจุฑ ุฏุฑ ุจุงุช ุจูู',

    -- ูุถุนุช
    status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending' COMMENT 'ูุถุนุช ุชุฃุฏ',
    is_active BOOLEAN DEFAULT TRUE,
    notes TEXT NULL,

    -- ุชุงุฑุฎโูุง
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    -- Indexes
    INDEX idx_deceased_code (deceased_employee_code),
    INDEX idx_primary_beneficiary (primary_beneficiary_national_code),
    INDEX idx_province (province_id),
    INDEX idx_status (status, is_active),

    FOREIGN KEY (province_id) REFERENCES provinces(id) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

---

## ๐ Business Rules

### ููุงูู ูพุฑุณูู
1. โ ูุฑ ูพุฑุณูู ูโุชูุงูุฏ ฺูุฏ ูููุงู ุฏุงุดุชู ุจุงุดุฏ
2. โ ูพุฑุณูู ุดุงุบู ู ุจุงุฒูุดุณุชู ูุฑ ุฏู ุณููู ุฏุงุฑูุฏ
3. โ ูุงููู 3 ุณุงูู ุจุฑ ุงุณุงุณ ฺฉุฏ ูพุฑุณูู ุงุนูุงู ูโุดูุฏ

### ููุงูู ูุธููโุจฺฏุฑุงู
1. โ ูุฑ ุฎุงููุงุฏู ููุช ุดุฏู ุจุง ฺฉุฏ ุงุณุชุฎุฏุงู ุดูุงุณุง ูโุดูุฏ
2. โ ุงุนุถุง: ููุท ููุณุฑ + ุฏุฎุชุฑุงู ูุฌุฑุฏ
3. โ ููุงฺฉ = ููุฑ ุงูู ุงุฒ ูุณุช (ุงูููุช ุฏุงุฑุฏ)
4. โ **ููุท ฺฉ ููุฑ** ุงุฒ ุงุนุถุง ูโุชูุงูุฏ ุฏุฑ ฺฉ ุฒูุงู ุฏุฑุฎูุงุณุช ุฏูุฏ
5. โ ุงฺฏุฑ ููุงฺฉ ุฏุฑุฎูุงุณุช ุฏุงุฏุ ุจูู ููโุชูุงููุฏ
6. โ ุงฺฏุฑ ุฏุฎุชุฑ ุงุฒุฏูุงุฌ ฺฉุฑุฏุ ุงุฒ ูุณุช ุญุฐู ูโุดูุฏ (manual update)
7. โ ูุงููู 3 ุณุงูู ุจุฑ ุงุณุงุณ ฺฉุฏ ุงุณุชุฎุฏุงู ููุช ุดุฏู ุงุนูุงู ูโุดูุฏ

### ููุงูู ูููุงูุงู
1. โ ูููุงูุงู ุณููู ูุฏุงุฑูุฏ
2. โ ููุท ูุณุช ุงุฒ ุงูุฑุงุฏ ููุฑุงู ูุณุชูุฏ
3. โ ฺฉ ูููุงู ูโุชูุงูุฏ ุฏุฑ ฺูุฏ ูพุฑุณูู ุชฺฉุฑุงุฑ ุดูุฏ (ูุซูุงู ูุงุฏุฑ ุฏู ุจุฑุงุฏุฑ)
4. โ ุฏุณุชูโุจูุฏ: ุจุงูฺฉ (ุชุนุฑูู ฺฉูุชุฑ) / ูุชูุฑูู (ุชุนุฑูู ุจุดุชุฑ)

---

## ๐ง Implementation Plan

### Phase 1: ุงุตูุงุญ Relations ู ุฏุณุชูโุจูุฏ
- [ ] ุงุถุงูู ฺฉุฑุฏู constants ุฌุฏุฏ ุจู `Personnel` model
  - `RELATION_FATHER_IN_LAW`
  - `RELATION_MOTHER_IN_LAW`
  - `RELATION_FRIEND`
  - `RELATION_RELATIVE`
- [ ] ุงุตูุงุญ ูุชุฏ `isFamilyMemberBankAffiliated()`
- [ ] ุจูโุฑูุฒุฑุณุงู ุจุงุช (BaleRegistrationFlow)
- [ ] ุจูโุฑูุฒุฑุณุงู ูุฑูโูุง ูุจ (personnel/create, personnel/edit)

### Phase 2: ุงุฌุงุฏ Beneficiary System
- [ ] ุงุฌุงุฏ migration ุจุฑุง `beneficiaries` table
- [ ] ุงุฌุงุฏ `Beneficiary` model
- [ ] ุงุฌุงุฏ controller: `BeneficiaryController`
- [ ] ุงุฌุงุฏ views:
  - `beneficiaries/index.blade.php`
  - `beneficiaries/create.blade.php`
  - `beneficiaries/show.blade.php`
  - `beneficiaries/edit.blade.php`
- [ ] ุงุถุงูู ฺฉุฑุฏู routes
- [ ] ุงุถุงูู ฺฉุฑุฏู ุจู sidebar

### Phase 3: ฺฉูพุงุฑฺูโุณุงุฒ ุจุง Lottery System
- [ ] ุงุตูุงุญ `LotteryEntry` ุจุฑุง ูพุดุชุจุงู ุงุฒ beneficiaries
- [ ] ุงุตูุงุญ `PriorityScoreService`
- [ ] ุงุตูุงุญ `LotteryService`
- [ ] ุงุตูุงุญ ฺฏุฒุงุฑุดุงุช

### Phase 4: ฺฉูพุงุฑฺูโุณุงุฒ ุจุง Bale Bot
- [ ] ุงุถุงูู ฺฉุฑุฏู ููู ุซุจุชโูุงู ูุธููโุจฺฏุฑุงู
- [ ] ุชุดุฎุต ุฎูุฏฺฉุงุฑ (ูพุฑุณูู ุง ูุธููโุจฺฏุฑุ)
- [ ] ูุฏุฑุช ูุญุฏูุฏุช (ููุท ฺฉ ููุฑ)

---

## โ Acceptance Criteria

### ูพุฑุณูู
- [x] ูพุฑุณูู ูโุชูุงูุฏ ุดุงุบู ุง ุจุงุฒูุดุณุชู ุจุงุดุฏ
- [ ] ูโุชูุงูุฏ 0 ุชุง N ูููุงู ุฏุงุดุชู ุจุงุดุฏ
- [ ] ูููุงูุงู ุจู 2 ุฏุณุชู ุชูุณู ูโุดููุฏ: ุจุงูฺฉ / ูุชูุฑูู
- [ ] 6 ููุน ุฎุงููุงุฏู ุจุงูฺฉ ู 3 ููุน ูุชูุฑูู

### ูุธููโุจฺฏุฑุงู
- [ ] ูโุชูุงูุฏ ุงุฌุงุฏุ ูุฑุงุดุ ุญุฐู ุดูุฏ
- [ ] ููุท ฺฉ ุนุถู ูโุชูุงูุฏ ุฏุฑุฎูุงุณุช ูุนุงู ุฏุงุดุชู ุจุงุดุฏ
- [ ] ููุงฺฉ ุงูููุช ุฏุงุฑุฏ
- [ ] ูโุชูุงูุฏ ูููุงู ุฏุงุดุชู ุจุงุดุฏ

### ูููุงูุงู
- [ ] ุจู ุตูุฑุช JSON ุฐุฎุฑู ูโุดููุฏ
- [ ] ุฏุณุชูโุจูุฏ ุตุญุญ (ุจุงูฺฉ/ูุชูุฑูู)
- [ ] ููุงุด ุจุง badge ุฏุฑ ูุณุชโูุง

---

## ๐ Timeline
- **Phase 1:** 2-3 ุณุงุนุช
- **Phase 2:** 4-5 ุณุงุนุช
- **Phase 3:** 2-3 ุณุงุนุช
- **Phase 4:** 3-4 ุณุงุนุช

**Total:** ~12-15 ุณุงุนุช ฺฉุงุฑ

---

**ุชุงุฑุฎ ุงุฌุงุฏ:** 1404/11/26
**ุขุฎุฑู ุจูโุฑูุฒุฑุณุงู:** 1404/11/26
**ูุถุนุช:** ุฏุฑ ุญุงู ูพุงุฏูโุณุงุฒ
