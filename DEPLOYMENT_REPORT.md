# ฺฏุฒุงุฑุด ฺฉุงูู Deploy ู ุชุบุฑุงุช ุณุงูุงูู ุฑูุงู
## ุชุงุฑุฎ: ฒฐ ุจููู ฑดฐด - ุณุงุนุช 11:15

---

## โ ฺฉุงุฑูุง ุงูุฌุงู ุดุฏู

### 1. ุขูพููุฏ ฺฉุงูู ูพุฑูฺู ุจู GitHub
- **Repository**: https://github.com/sedalcrazy-create/welfare
- **Branch ุงุตู**: `main`
- **ุชุนุฏุงุฏ Commits**: 4 ฺฉุงูุช
- **ุขุฎุฑู Commit**: `da426f4 - Add deployment documentation and scripts`

### 2. ุชุบุฑุงุช ุงุตู ุฏุฑ ฺฉุฏ (ูุงุฒ 1)

#### ๐๏ธ Database (3 Migration ุฌุฏุฏ):
1. **`2024_02_09_000001_simplify_personnel_for_phase1.php`**
   - ุงุถุงูู ุดุฏู: `status`, `registration_source`, `preferred_center_id`, `notes`, `tracking_code`
   - `province_id` ู `employee_code` โ nullable ุดุฏ

2. **`2024_02_09_000002_create_introduction_letters_table.php`**
   - ุฌุฏูู ุฌุฏุฏ ุจุฑุง ูุนุฑูโูุงููโูุง
   - ููุฏูุง: `letter_code`, `personnel_id`, `center_id`, `issued_by_user_id`, `family_count`, `status`

3. **`2024_02_09_000003_add_quota_to_users_table.php`**
   - ุณุณุชู ุณูููโุจูุฏ ุจุฑุง ูุฏุฑุงู
   - ููุฏูุง: `quota_total`, `quota_used`, `quota_remaining` (virtual)

#### ๐ฆ Models (3 ูุฏู):
1. **IntroductionLetter** (ุฌุฏุฏ)
   - ูุชุฏูุง: `generateLetterCode()`, `markAsUsed()`, `cancel()`, `isActive()`

2. **Personnel** (ุจูโุฑูุฒุฑุณุงู)
   - Constants: `STATUS_*`, `SOURCE_*`
   - Scopes: `pending()`, `approved()`, `rejected()`
   - ูุชุฏ: `generateTrackingCode()`

3. **User** (ุจูโุฑูุฒุฑุณุงู)
   - ูุชุฏูุง: `getQuotaRemaining()`, `hasQuotaAvailable()`, `incrementQuotaUsed()`, `decrementQuotaUsed()`

#### ๐ฎ Controllers (3 ฺฉูุชุฑูุฑ):
1. **PersonnelRequestController** (Web) - ูุฏุฑุช ุฏุฑุฎูุงุณุชโูุง
2. **IntroductionLetterController** (Web) - ุตุฏูุฑ ูุนุฑูโูุงูู
3. **PersonnelRequestController** (API) - ุซุจุช ุฏุฑุฎูุงุณุช ุงุฒ ุจุงุช ุจูู

#### ๐ฃ๏ธ Routes ุฌุฏุฏ:
**Web:**
- `/personnel-requests/*` - ูุฏุฑุช ุฏุฑุฎูุงุณุชโูุง
- `/introduction-letters/*` - ูุฏุฑุช ูุนุฑูโูุงููโูุง

**API:**
- `GET /api/bale/centers` - ูุณุช ูุฑุงฺฉุฒ
- `POST /api/bale/register` - ุซุจุช ุฏุฑุฎูุงุณุช
- `POST /api/bale/check-status` - ฺฺฉ ูุถุนุช
- `POST /api/bale/letters` - ูุนุฑูโูุงููโูุง ูู

---

## ๐ Workflow ุฌุฏุฏ ุณุณุชู

```
ูุฑุญูู 1: ุซุจุช ุฏุฑุฎูุงุณุช
โโโ ุงุฒ ุจุงุช ุจูู (self-registration)
โ   โโโ ูุฑู: ูุงูุ ฺฉุฏ ููุ ููุจุงูุ ุชุนุฏุงุฏ ุฎุงููุงุฏูุ ูุฑฺฉุฒ
โโโ ุซุจุช ุฏุณุช ุฏุฑ ูพูู
    โโโ ุชูุณุท ุงุฏูู/ุงูพุฑุงุชูุฑ

โ

ูุฑุญูู 2: ุจุฑุฑุณ [status: pending]
โโโ ูุฏุฑ/ฺฉุงุฑูุฑูุง ูโุจูู ุฏุฑ ูุณุช
โโโ ฺฺฉ ูโฺฉูู ุฏุณุช (ฺฉุฏ ููุ ุงุทูุงุนุงุช)
โโโ ุชุตูู: โ ุชุฃุฏ ุง โ ุฑุฏ

โ

ูุฑุญูู 3: ุตุฏูุฑ ูุนุฑูโูุงูู [status: approved]
โโโ ุชููุฏ ฺฉุฏ ููฺฉ: MHD-0411-0001
โโโ ฺฉุงูุด ุณููู ูุฏุฑ
โโโ ุฐุฎุฑู ูุนุฑูโูุงูู
โโโ ููุชูฺฉุดู ุจู ฺฉุงุฑุจุฑ

โ

ูุฑุญูู 4: ุงุณุชูุงุฏู/ูุบู
โโโ ุงุณุชูุงุฏู ุดุฏู [status: used]
โโโ ูุบู [status: cancelled] โ ุจุงุฒฺฏุดุช ุณููู
```

---

## ๐ Deploy ุฑู ุณุฑูุฑ

### ูุถุนุช ุณุฑูุฑ:
- **IP**: 37.152.174.87
- **OS**: Ubuntu 22.04.5 LTS
- **ูุณุฑ**: `/var/www/welfare`
- **ูพูุฑุช ูุจ**: 8083
- **URL**: https://ria.jafamhis.ir/welfare

### ูุดฺฉูุงุช ูพุด ุขูุฏู:
1. โ **Dockerfile Build Error**: PECL ููโุชูุงูุฏ Redis ูุตุจ ฺฉูุฏ
2. โ **Alpine Package Issues**: ูุดฺฉู network ุฏุฑ ุฏุฑุงูุช ูพฺฉุฌโูุง
3. โ๏ธ **Container ูุง ูุฏู**: ูุงุฒ ุจู rebuild ุจุง ฺฉุฏ ุฌุฏุฏ

### ุฑุงู ุญู ูููุช:
- ฺฉุฏ ุฌุฏุฏ ุฏุฑ `/var/www/welfare` ูุฑุงุฑ ฺฏุฑูุช
- ูุงุฒ ุจู ุชุนูุฑ Dockerfile
- ุงุณุชูุงุฏู ุงุฒ image ูุง ุงุฒ ูุจู build ุดุฏู (ูููุช)

---

## ๐ ุชูุงูุชโูุง ุงุตู ุจุง ุณุณุชู ูุจู

| ูฺฺฏ | ูุจู | ุจุนุฏ (ูุงุฒ 1) |
|-------|-----|------------|
| ูุฑุนูโฺฉุด | โ ูพฺุฏู ุจุง ุงูฺฏูุฑุชู ุงูุชุงุฒุฏู | โ ุญุฐู ุดุฏ |
| ุซุจุชโูุงู | ุจุงุฏ ุงุฒ ูุจู ุฏุฑ ุณุณุชู ุจุงุดู | โ Self-registration ุงุฒ ุจุงุช |
| ุชุฃุฏ | ุจุนุฏ ุงุฒ ูุฑุนูโฺฉุด | โ ูุจู ุงุฒ ุตุฏูุฑ ูุนุฑูโูุงูู |
| ุณููู | ุจู ุตูุฑุช ุงุณุชุงู | โ ุจู ุตูุฑุช ุดุฎุต (ูุฑ ูุฏุฑ) |
| ูุงููู 3 ุณุงู | โ ูุนุงู | โ ูุนูุง ุบุฑูุนุงู |
| ุชุฎุตุต ูุงุญุฏ | ุฎูุฏฺฉุงุฑ | โ ุฏุณุช (ูุนูุง) |

---

## ๐ฏ API Endpoints ูุนุงู

### ุจุฑุง ุจุงุช ุจูู (Public):
```bash
# ุฏุฑุงูุช ูุฑุงฺฉุฒ
GET /api/bale/centers

# ุซุจุช ุฏุฑุฎูุงุณุช
POST /api/bale/register
{
  "full_name": "ุนู ุงุญูุฏ",
  "national_code": "1234567890",
  "phone": "09123456789",
  "family_count": 4,
  "preferred_center_id": 1,
  "bale_user_id": "optional"
}

# ฺฺฉ ูุถุนุช
POST /api/bale/check-status
{
  "identifier": "1234567890",
  "identifier_type": "national_code"
}

# ุฏุฑุงูุช ูุนุฑูโูุงููโูุง
POST /api/bale/letters
{
  "national_code": "1234567890"
}
```

### Response ููููู:
```json
{
  "success": true,
  "message": "ุฏุฑุฎูุงุณุช ุดูุง ุจุง ููููุช ุซุจุช ุดุฏ",
  "data": {
    "tracking_code": "REQ-A1B2C3D4",
    "full_name": "ุนู ุงุญูุฏ",
    "national_code": "1234567890",
    "family_count": 4,
    "preferred_center": "ุฒุงุฆุฑุณุฑุง ูุดูุฏ ููุฏุณ",
    "status": "ุฏุฑ ุงูุชุธุงุฑ ุจุฑุฑุณ",
    "registered_at": "1404/11/20 11:15"
  }
}
```

---

## ๐ ุขูุงุฑ ู ุงุทูุงุนุงุช

### ูุงูโูุง ุงุฌุงุฏ ุดุฏู:
- **Migrations**: 3 ูุงู
- **Models**: 1 ุฌุฏุฏ + 2 ุจูโุฑูุฒุฑุณุงู
- **Controllers**: 3 ูุงู
- **Views**: 2 ุตูุญู
- **Documentation**: 4 ูุงู (README, PHASE1_README, DEPLOYMENT_GUIDE, deploy.sh)
- **Scripts**: 2 ุงุณฺฉุฑูพุช (deploy.sh, update.sh)

### ุฎุทูุท ฺฉุฏ:
- **PHP**: ~1,800 ุฎุท
- **Blade**: ~600 ุฎุท
- **SQL Migrations**: ~300 ุฎุท
- **Documentation**: ~1,200 ุฎุท

---

## ๐ง ฺฉุงุฑูุง ุจุงู ูุงูุฏู

### ููุฑ (Priority 1):
1. โ ุชุนูุฑ Dockerfile ุจุฑุง ูุตุจ Redis
2. โ ุงุฌุฑุง migrations ุฌุฏุฏ ุฑู ุณุฑูุฑ
3. โ ุชุณุช API endpoints
4. โ ุชุฎุตุต ุณููู ุงููู ุจู ูุฏุฑุงู

### ฺฉูุชุงู ูุฏุช (Priority 2):
1. โณ ุงุฌุงุฏ views ุจุงูโูุงูุฏู (`create.blade.php`, `edit.blade.php`)
2. โณ ูพุงุฏูโุณุงุฒ print/download PDF ุจุฑุง ูุนุฑูโูุงูู
3. โณ ููุชูฺฉุดู ุจู ฺฉุงุฑุจุฑ (ูพุงูฺฉ/ุจุงุช)
4. โณ ุฏุงุดุจูุฑุฏ ุขูุงุฑ

### ูุงู ูุฏุช (Priority 3):
1. โฌ validation ุจุง ุณุณุชู HR
2. โฌ ุชุฎุตุต ุฎูุฏฺฉุงุฑ ุงุณุชุงู ุจุฑ ุงุณุงุณ ูุญู ุฎุฏูุช
3. โฌ ฺฏุฒุงุฑุดโฺฏุฑ ูพุดุฑูุชู
4. โฌ ูพุงุฏูโุณุงุฒ ูุงููู 3 ุณุงู

### ุจููุฏ ูุฏุช (Priority 4):
1. โฌ ุจุงุฒฺฏุดุช ุจู ุณุณุชู ูุฑุนูโฺฉุด (ุงุฎุชุงุฑ)
2. โฌ ุงูฺฏูุฑุชู ุงูุชุงุฒุฏู (ุงุฎุชุงุฑ)
3. โฌ ุชุฎุตุต ุฎูุฏฺฉุงุฑ ูุงุญุฏ
4. โฌ ูพุฑุฏุงุฎุช ุขููุงู

---

## ๐ ุงููุช

### ุชูุธูุงุช ุงููุช ุงูุฌุงู ุดุฏู:
- โ `.gitignore` ุจุฑุง ุญูุธ `.env` ู secrets
- โ `APP_DEBUG=false` ุฏุฑ production
- โ ุฑูุฒูุง ูู ุฏุฑ `.env.production`
- โ Validation ุฏูู ุฏุฑ API endpoints

### ุชูุธูุงุช ุชูุตู ุดุฏู:
- โ๏ธ ุชุบุฑ ุฑูุฒ ูพุดโูุฑุถ ุงุฏูู
- โ๏ธ ูุนุงูโุณุงุฒ Firewall (UFW)
- โ๏ธ ุชูุธู ุจฺฉุงูพ ุฎูุฏฺฉุงุฑ
- โ๏ธ ูุงูุชูุฑูฺฏ ู ูุงฺฏโฺฏุฑ

---

## ๐ ุฏุณุชูุฑุงุช ฺฉุงุฑุจุฑุฏ

### ุจูโุฑูุฒุฑุณุงู ฺฉุฏ:
```bash
ssh root@37.152.174.87
cd /var/www/welfare
git pull origin main
docker compose exec app php artisan migrate --force
docker compose exec app php artisan cache:clear
docker compose restart app
```

### ูุดุงูุฏู ูุงฺฏ:
```bash
docker compose logs -f app
# ุง
docker compose exec app tail -f storage/logs/laravel.log
```

### ุชุฎุตุต ุณููู:
```bash
docker compose exec app php artisan tinker
```
```php
$user = User::where('email', 'admin@bankmelli.ir')->first();
$user->quota_total = 100;
$user->save();
```

### ุจฺฉุงูพ ุฏุชุงุจุณ:
```bash
docker compose exec welfare_postgres pg_dump -U welfare_user welfare_system > backup_$(date +%Y%m%d).sql
```

---

## ๐ ููุงุณู ุนููฺฉุฑุฏ

| ูุนุงุฑ | ูุจู | ุจุนุฏ | ุจูุจูุฏ |
|-------|-----|-----|-------|
| ุชุนุฏุงุฏ Models | 11 | 11 | - |
| ุชุนุฏุงุฏ Controllers | 10 | 13 | +30% |
| ุชุนุฏุงุฏ Migrations | 11 | 14 | +27% |
| ุชุนุฏุงุฏ API Endpoints | 15 | 19 | +27% |
| ุฎุทูุท ฺฉุฏ PHP | ~4000 | ~5800 | +45% |
| ูุณุชูุฏุงุช | 3 ูุงู | 7 ูุงู | +133% |

---

## โ ูุชุฌูโฺฏุฑ

### ููููุชโูุง:
1. โ ฺฉุฏ ุจุง ููููุช ุจู GitHub push ุดุฏ
2. โ ูุงุฒ 1 ฺฉุงูู ูพุงุฏูโุณุงุฒ ุดุฏ (ุจุฏูู ูุฑุนูโฺฉุด)
3. โ API ุจุฑุง ุจุงุช ุจูู ุขูุงุฏู ุงุณุช
4. โ ุณุณุชู ุณูููโุจูุฏ ูพุงุฏู ุดุฏ
5. โ ูุณุชูุฏุงุช ฺฉุงูู ููุดุชู ุดุฏ

### ฺุงูุดโูุง:
1. โ๏ธ ูุดฺฉู Build ุฏุฑ Dockerfile (ูุงุฒ ุจู ุชุนูุฑ)
2. โ๏ธ ูุงุฒ ุจู ุงุฌุฑุง migrations ุฑู ุณุฑูุฑ
3. โ๏ธ ูุงุฒ ุจู ุชุณุช ฺฉุงูู API

### ฺฏุงู ุจุนุฏ:
1. ุชุนูุฑ Dockerfile ู ุงุฌุฑุง ูููู containers
2. ุงุฌุฑุง migrations
3. ุชุณุช API endpoints
4. ุชุฎุตุต ุณููู ุจู ูุฏุฑุงู
5. ุดุฑูุน ุชุณุช ุจุง ุจุงุช ุจูู

---

## ๐ ููุงุจุน

- **GitHub Repository**: https://github.com/sedalcrazy-create/welfare
- **PHASE1_README.md**: ูุณุชูุฏุงุช ูุงุฒ 1
- **DEPLOYMENT_GUIDE.md**: ุฑุงูููุง deploy
- **CLAUDE.md**: ุฑุงูููุง ฺฉู ูพุฑูฺู

---

**ุชุงุฑุฎ**: ฒฐ ุจููู ฑดฐด
**ูุณุฎู**: 1.1.0-phase1
**ูุถุนุช**: ุฏุฑ ุญุงู ุชูุณุนู - ุขูุงุฏู ุจุฑุง ุชุณุช
